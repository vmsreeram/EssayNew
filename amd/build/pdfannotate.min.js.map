{"version":3,"file":"pdfannotate.min.js","sources":["../src/pdfannotate.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * OnClick handlers are defined here\n * These functions will call functions in pdfannotate.js.\n *\n * @subpackage essayannotate\n * @copyright  2024 IIT Palakkad\n * @copyright  based on work done by Ravisha Hesh {@link https://github.com/RavishaHesh/PDFJsAnnotations}\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * PDFAnnotate v1.0.1\n * Author: Ravisha Heshan\n */\n\n /**\n * @updatedby Asha Jose and Parvathy S Kumar\n * SerializePDF and SavePDF functions are modified.\n */\n\ndefine(['qtype_essayannotate/fabric', 'qtype_essayannotate/pdf', 'jquery'], function(fabric, pdfjsLib, $) {\n\nvar contextid,attemptid,filename,usageid,slot;\nvar PDFAnnotate = function(container_id, url, options = {}) {\n    this.number_of_pages = 0;\n    this.pages_rendered = 0;\n    this.active_tool = 1; // 1 - Free hand, 2 - Text, 3 - Arrow, 4 - Rectangle\n    this.fabricObjects = [];\n    this.fabricObjectsData = [];\n    this.color = 'rgb(0,0,0)';\n    this.borderColor = 'rgb(0,0,0)';\n    this.borderSize = 1;\n    this.font_size = 16;\n    this.active_canvas = 0;\n    this.container_id = container_id;\n    this.url = url;\n    this.pageImageCompression = options.pageImageCompression\n    ? options.pageImageCompression.toUpperCase()\n    : \"NONE\";\n    this.textBoxText = 'Edit Text';\n    this.highlightBoxWidth=400;\n    this.highlightBoxHeight=50;\n    this.highlightBoxOpacity=0.3;\n    this.freeDrawingBrushWidth=2;\n    var inst = this;\n    pdfjsLib.GlobalWorkerOptions.workerSrc = '../amd/build/pdfworker.min.js';\n    var loadingTask = pdfjsLib.getDocument(this.url);\n    loadingTask.promise.then(function (pdf) {\n        var scale = options.scale ? options.scale : 1.3;\n        inst.number_of_pages = pdf.numPages;\n\n        for (var i = 1; i <= pdf.numPages; i++) {\n\n            pdf.getPage(i).then(function (page) {    //Creating canvas and rendering pages in the canvas\n                if (typeof inst.format === 'undefined' ||\n                typeof inst.orientation === 'undefined') {\n                    var originalViewport = page.getViewport({ scale: 1 });\n                    inst.format = [originalViewport.width, originalViewport.height];\n                    inst.orientation =\n                    originalViewport.width > originalViewport.height ?\n                        'landscape' :\n                        'portrait';\n                }\n\n                var viewport = page.getViewport({scale: scale});\n                var canvas = document.createElement('canvas');\n                document.getElementById(inst.container_id).appendChild(canvas);\n                canvas.className = 'pdf-canvas';\n                canvas.height = viewport.height;\n                canvas.width = viewport.width;\n\n                var context = canvas.getContext('2d');\n                var renderContext = {\n                    canvasContext: context,\n                    viewport: viewport\n                };\n                var renderTask = page.render(renderContext);\n\n                renderTask.promise.then(function () {\n                    $('.pdf-canvas').each(function (index, el) {\n                        $(el).attr('id', 'page-' + (index + 1) + '-canvas');\n                    });\n                    inst.pages_rendered++;\n                    if (inst.pages_rendered == inst.number_of_pages) //Calling initFabric() after rendering the entire pages\n                    {\n                        inst.initFabric();\n                    }\n                });\n            });\n        }\n    }, function (reason) { // eslint-disable-line no-unused-vars\n        // console.error(reason);\n    });\n\n    this.initFabric = function () {\n        var inst = this;\n        let canvases = $('#' + inst.container_id + ' canvas');\n        canvases.each(function (index, el) {\n            var background = el.toDataURL(\"image/png\");\n            var fabricObj = new fabric.Canvas(el.id, {});\n            inst.fabricObjects.push(fabricObj);\n            if (typeof options.onPageUpdated == 'function') {\n                fabricObj.on('object:added', function() {\n                    var oldValue = Object.assign({}, inst.fabricObjectsData[index]);\n                    inst.fabricObjectsData[index] = fabricObj.toJSON();\n                    options.onPageUpdated(index + 1, oldValue, inst.fabricObjectsData[index]);\n                });\n            }\n            fabricObj.setBackgroundImage(background, fabricObj.renderAll.bind(fabricObj));\n            $(fabricObj.upperCanvasEl).click(function (event) {\n                inst.active_canvas = index;\n                inst.fabricClickHandler(event, fabricObj);\n            });\n            fabricObj.on('after:render', function () {\n                inst.fabricObjectsData[index] = fabricObj.toJSON();\n                fabricObj.off('after:render');\n            });\n\n            if (index === canvases.length - 1 && typeof options.ready === 'function') {\n                options.ready();\n            }\n        });\n    };\n\n    this.fabricClickHandler = function (event, fabricObj) {\n        var inst = this;\n        var activeObject = inst.fabricObjects[inst.active_canvas].getActiveObject();\n        var toolObj;\n\n        if (inst.active_tool == 2) {    //Text Box\n          toolObj = new fabric.IText(inst.textBoxText, {\n            left: event.clientX - fabricObj.upperCanvasEl.getBoundingClientRect().left,\n            top: event.clientY - fabricObj.upperCanvasEl.getBoundingClientRect().top,\n            fill: inst.color,\n            fontSize: inst.font_size,\n            lockRotation: true,\n            lockScalingX: true,\n            lockScalingY: true\n          });\n        }\n        else if (inst.active_tool == 4) {    //Highlight Box\n          toolObj = new fabric.Rect({\n            left: event.clientX - fabricObj.upperCanvasEl.getBoundingClientRect().left,\n            top: event.clientY - fabricObj.upperCanvasEl.getBoundingClientRect().top,\n            width: inst.highlightBoxWidth,\n            height:  inst.highlightBoxHeight,\n            fill: inst.color,\n            opacity: inst.highlightBoxOpacity,\n            lockRotation: true\n          });\n        }\n        else if(inst.active_tool== 0) {    //Select\n              if(activeObject) {\n                //locking the rotation and scaling of free hand brush, if it is currently selected\n                if(activeObject.get('type')== 'path') {\n                activeObject.set({\n                    lockScalingX: true,\n                    lockScalingY: true,\n                    lockRotation: true});\n                }\n            }\n          }\n\n        //Change the current selected tool in the UI to Select if the active tool is highlight box or text\n        if (inst.active_tool == 2 || inst.active_tool == 4) {\n            var element = document.querySelector(\"#select\");\n            $(\".tool-button.active\").removeClass(\"active\");\n            $(element).addClass(\"active\");\n        }\n\n        //Change the currently active tool to Select\n        inst.active_tool = 0;\n        if (toolObj) {\n                fabricObj.add(toolObj);\n        }\n    };\n};\n\nPDFAnnotate.prototype.enableSelector = function () {\n    var inst = this;\n    inst.active_tool = 0;\n    if (inst.fabricObjects.length > 0) {\n        $.each(inst.fabricObjects, function (index, fabricObj) {\n            fabricObj.isDrawingMode = false;\n        });\n    }\n\n\n};\n\nPDFAnnotate.prototype.enablePencil = function () {\n    var inst = this;\n    inst.active_tool = 1;\n    if (inst.fabricObjects.length > 0) {\n        $.each(inst.fabricObjects, function (index, fabricObj) {\n            fabricObj.freeDrawingBrush.width=inst.freeDrawingBrushWidth;    //Changed default brush size\n            fabricObj.isDrawingMode = true;\n        });\n    }\n\n};\n\nPDFAnnotate.prototype.enableAddText = function () {\n    var inst = this;\n    inst.active_tool = 2;\n    if (inst.fabricObjects.length > 0) {\n        $.each(inst.fabricObjects, function (index, fabricObj) {\n            fabricObj.isDrawingMode = false;\n        });\n    }\n\n};\n\nPDFAnnotate.prototype.enableRectangle = function () {\n    var inst = this;\n    inst.active_tool = 4;\n    if (inst.fabricObjects.length > 0) {\n        $.each(inst.fabricObjects, function (index, fabricObj) {\n            fabricObj.isDrawingMode = false;\n        });\n    }\n};\n\nPDFAnnotate.prototype.deleteSelectedObject = function () {\n    var inst = this;\n    var activeObject = inst.fabricObjects[inst.active_canvas].getActiveObject();\n    if (activeObject)\n    {\n        if (confirm('Are you sure ?'))\n        {\n            inst.fabricObjects[inst.active_canvas].remove(activeObject);\n        }\n    }\n};\n\n//Updated by Asha Jose and Parvathy S Kumar\n  PDFAnnotate.prototype.savePdf = function () {\n    //Calling the serializePdf function\n    this.serializePdf(function (string) {\n      var value = JSON.stringify(JSON.parse(string), null, 4);\n\n      var xmlhttp = new XMLHttpRequest();    //Creating an HTTP request instance\n      xmlhttp.open(\"POST\", \"upload.php\", true);\n      xmlhttp.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n      //Sending data to upload.php\n      xmlhttp.send(\"data=\" + value + \"&contextid=\" + contextid + \"&attemptid=\"+attemptid        // changed id to data\n      + \"&filename=\" + filename + \"&usageid=\" + usageid + \"&slot=\" + slot);\n      xmlhttp.onreadystatechange = function() {\n\n        //Getting the response once upload.php finishes execution\n        //readyState will become 4 if the execution finishes\n        if (this.status == 200 && this.readyState == 4) {\n            showMessage(1);\n        } else if (this.status != 200 && this.readyState == 4) {\n            showMessage(0);\n        }\n\n        /**\n         * Displays a message box with the given message.\n         *\n         * @param {int} message - 1 if the file has been saved, 0 otherwise.\n         */\n        function showMessage(message) {\n            // Getting the message box\n            var messageBox = document.getElementById(\"message-box-saved\");\n            if(message==0) {\n                messageBox = document.getElementById(\"message-box-not-saved\");\n            }\n\n            // Showing the message box\n            messageBox.classList.remove(\"hidden\");\n\n            // Automatically remove the message box after 3 seconds\n            setTimeout(function () {\n                messageBox.style.opacity = \"0\";\n                setTimeout(function () {\n                    document.getElementById(\"essayannotator-annotator\").removeChild(messageBox);\n                    window.close();\n                    window.opener.location.reload();\n                }, 500); // Fade-out transition time\n            }, 3000); // Display time\n        }\n      };\n    });\n};\n\n\n//Convert the Page Annotations to JSON data\nPDFAnnotate.prototype.serializePdf = function (callback) {\n    var inst = this;\n    var pageAnnotations=[];\n    //Initialising list of fabric objects for each page\n    //Length of fabricObjects is the number of pages\n    for (let i = 0; i < inst.fabricObjects.length; i++) {\n      pageAnnotations.push([]);\n    }\n\n    //The function is invoked for each page  to iterate through the annotations\n    inst.fabricObjects.forEach(function (fabricObject,index) {\n      fabricObject.clone(function (fabricObjectCopy) {\n        fabricObjectCopy.setBackgroundImage(null);\n        fabricObjectCopy.setBackgroundColor('');\n        if(fabricObjectCopy._objects.length !== 0)    //Checking if the page has any annotations\n        {\n            for(var j=0; j< fabricObjectCopy._objects.length ; j++)    //Iterate through the list of annotations\n              {\n                //Used to handle the translation of path object(free hand)\n                if(fabricObjectCopy._objects[j].get('type')== 'path')\n                {\n                    var pathObj = fabricObjectCopy._objects[j];\n                    var matrix=pathObj.calcTransformMatrix();\n                    var pointsList = pathObj.path;\n                    var length = Object.keys(pointsList).length;\n                    var offsetX=pathObj.pathOffset.x;\n                    var offsetY=pathObj.pathOffset.y;\n                    for(var i=0; i< length;i++)\n                    {\n                        var point1= new fabric.Point(pointsList[i][1],pointsList[i][2]);\n                        var newPoints1= fabric.util.transformPoint(point1, matrix);\n                        pointsList[i][1] = newPoints1.x - offsetX;\n                        pointsList[i][2] = newPoints1.y - offsetY;\n\n                        if(i!=0 && i!=length -1)\n                        //First and Last elements in the pointsList have only a single set of coordinate\n                        //All the other elements have 2 set of points\n                        {\n                            var point2= new fabric.Point(pointsList[i][3],pointsList[i][4]);\n                            var newPoints2= fabric.util.transformPoint(point2, matrix);\n                            pointsList[i][3] = newPoints2.x - offsetX;\n                            pointsList[i][4] = newPoints2.y - offsetY;\n                        }\n                    }\n                    //Copy transformed list of points to the path object\n                    fabricObjectCopy._objects[j].path=pointsList;\n                }\n              }\n\n            pageAnnotations[index].push(fabricObjectCopy);\n        }\n\n        if (index+1 === inst.fabricObjects.length) {\n          var data = {\n            page_setup: {\n              format: inst.format,\n              orientation: inst.orientation,\n            },\n            pages: pageAnnotations,\n          };\n          callback(JSON.stringify(data));    //The serialized data is converted to JSON\n        }\n      });\n    });\n  };\n//Updation ends\n\nPDFAnnotate.prototype.setColor = function (color) {\n    var inst = this;\n    inst.color = color;\n    $.each(inst.fabricObjects, function (index, fabricObj) {\n        fabricObj.freeDrawingBrush.color = color;\n    });\n};\n\nPDFAnnotate.prototype.setBorderColor = function (color) {\n    var inst = this;\n    inst.borderColor = color;\n};\n\nPDFAnnotate.prototype.setFontSize = function (size) {\n    this.font_size = size;\n};\n\nreturn {\n    PDFAnnotate: PDFAnnotate, // Exporting PDFAnnotate constructor\n    init: function(contextId, attemptId, fileName, usageId, sloT) {\n        contextid = contextId;\n        attemptid = attemptId;\n        filename = fileName;\n        usageid = usageId;\n        slot = sloT;\n    }\n};\n});"],"names":["define","fabric","pdfjsLib","$","contextid","attemptid","filename","usageid","slot","PDFAnnotate","container_id","url","options","arguments","length","undefined","this","number_of_pages","pages_rendered","active_tool","fabricObjects","fabricObjectsData","color","borderColor","borderSize","font_size","active_canvas","pageImageCompression","toUpperCase","textBoxText","highlightBoxWidth","highlightBoxHeight","highlightBoxOpacity","freeDrawingBrushWidth","inst","GlobalWorkerOptions","workerSrc","getDocument","promise","then","pdf","scale","numPages","i","getPage","page","format","orientation","originalViewport","getViewport","width","height","viewport","canvas","document","createElement","getElementById","appendChild","className","renderContext","canvasContext","getContext","render","each","index","el","attr","initFabric","reason","canvases","background","toDataURL","fabricObj","Canvas","id","push","onPageUpdated","on","oldValue","Object","assign","toJSON","setBackgroundImage","renderAll","bind","upperCanvasEl","click","event","fabricClickHandler","off","ready","toolObj","activeObject","getActiveObject","IText","left","clientX","getBoundingClientRect","top","clientY","fill","fontSize","lockRotation","lockScalingX","lockScalingY","Rect","opacity","get","set","element","querySelector","removeClass","addClass","add","prototype","enableSelector","isDrawingMode","enablePencil","freeDrawingBrush","enableAddText","enableRectangle","deleteSelectedObject","confirm","remove","savePdf","serializePdf","string","value","JSON","stringify","parse","xmlhttp","XMLHttpRequest","open","setRequestHeader","send","onreadystatechange","showMessage","message","messageBox","classList","setTimeout","style","removeChild","window","close","opener","location","reload","status","readyState","callback","pageAnnotations","forEach","fabricObject","clone","fabricObjectCopy","setBackgroundColor","_objects","j","pathObj","matrix","calcTransformMatrix","pointsList","path","keys","offsetX","pathOffset","x","offsetY","y","point1","Point","newPoints1","util","transformPoint","point2","newPoints2","data","page_setup","pages","setColor","setBorderColor","setFontSize","size","init","contextId","attemptId","fileName","usageId","sloT"],"mappings":"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"}