{"version":3,"file":"pdfannotate.min.js","sources":["../src/pdfannotate.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * OnClick handlers are defined here\n * These functions will call functions in pdfannotate.js.\n *\n * @module     qtype_essayannotate/pdfannotate\n * @copyright  2024 IIT Palakkad\n * @copyright  based on work done by Ravisha Hesh {@link https://github.com/RavishaHesh/PDFJsAnnotations}\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * PDFAnnotate v1.0.1\n * @author     Ravisha Hesh\n * @updatedby  Asha Jose and Parvathy S Kumar\n *             SerializePDF and SavePDF functions are modified.\n * @updatedby  Nideesh N, VM Sreeram\n *             Convert PDFAnnotate into AMD format, changed pdf workersrc to local version instead of cdn,\n *             removed call to onPageUpdated function\n */\n\ndefine(['qtype_essayannotate/fabric', 'qtype_essayannotate/pdf', 'jquery'], function(fabric, pdfjsLib, $) {\n\nvar contextid, attemptid, filename, usageid, slot;\nvar PDFAnnotate = function(containerId, url, options = {}) {\n    this.numberOfPages = 0;\n    this.pagesRendered = 0;\n    this.activeTool = 1; // 1 - Free hand, 2 - Text, 3 - Arrow, 4 - Rectangle\n    this.fabricObjects = [];\n    this.fabricObjectsData = [];\n    this.color = 'rgb(0,0,0)';\n    this.borderColor = 'rgb(0,0,0)';\n    this.borderSize = 1;\n    this.font_size = 16;\n    this.activeCanvas = 0;\n    this.containerId = containerId;\n    this.url = url;\n    this.pageImageCompression = options.pageImageCompression\n    ? options.pageImageCompression.toUpperCase()\n    : \"NONE\";\n    this.textBoxText = 'Edit Text';\n    this.highlightBoxWidth = 400;\n    this.highlightBoxHeight = 50;\n    this.highlightBoxOpacity = 0.3;\n    this.freeDrawingBrushWidth = 2;\n    var inst = this;\n    pdfjsLib.GlobalWorkerOptions.workerSrc = '../amd/build/pdfworker.min.js';\n    var loadingTask = pdfjsLib.getDocument(this.url);\n    loadingTask.promise.then(function(pdf) {\n        var scale = options.scale ? options.scale : 1.3;\n        inst.numberOfPages = pdf.numPages;\n\n        for (var i = 1; i <= pdf.numPages; i++) {\n\n            pdf.getPage(i).then(function(page) { // Creating canvas and rendering pages in the canvas\n                if (typeof inst.format === 'undefined' ||\n                typeof inst.orientation === 'undefined') {\n                    var originalViewport = page.getViewport({scale: 1});\n                    inst.format = [originalViewport.width, originalViewport.height];\n                    inst.orientation =\n                    originalViewport.width > originalViewport.height ?\n                        'landscape' :\n                        'portrait';\n                }\n\n                var viewport = page.getViewport({scale: scale});\n                var canvas = document.createElement('canvas');\n                document.getElementById(inst.containerId).appendChild(canvas);\n                canvas.className = 'pdf-canvas';\n                canvas.height = viewport.height;\n                canvas.width = viewport.width;\n\n                var context = canvas.getContext('2d');\n                var renderContext = {\n                    canvasContext: context,\n                    viewport: viewport\n                };\n                var renderTask = page.render(renderContext);\n\n                renderTask.promise.then(function() {\n                    $('.pdf-canvas').each(function(index, el) {\n                        $(el).attr('id', 'page-' + (index + 1) + '-canvas');\n                    });\n                    inst.pagesRendered++;\n                    if (inst.pagesRendered == inst.numberOfPages) { // Calling initFabric() after rendering the entire pages\n                        inst.initFabric();\n                    }\n                });\n            });\n        }\n    }, function(reason) { // eslint-disable-line no-unused-vars\n    });\n\n    this.initFabric = function() {\n        var inst = this;\n        let canvases = $('#' + inst.containerId + ' canvas');\n        canvases.each(function(index, el) {\n            var background = el.toDataURL(\"image/png\");\n            var fabricObj = new fabric.Canvas(el.id, {});\n            inst.fabricObjects.push(fabricObj);\n            fabricObj.setBackgroundImage(background, fabricObj.renderAll.bind(fabricObj));\n            $(fabricObj.upperCanvasEl).click(function(event) {\n                inst.activeCanvas = index;\n                inst.fabricClickHandler(event, fabricObj);\n            });\n            fabricObj.on('after:render', function() {\n                inst.fabricObjectsData[index] = fabricObj.toJSON();\n                fabricObj.off('after:render');\n            });\n\n            if (index === canvases.length - 1 && typeof options.ready === 'function') {\n                options.ready();\n            }\n        });\n    };\n\n    this.fabricClickHandler = function(event, fabricObj) {\n        var inst = this;\n        var activeObject = inst.fabricObjects[inst.activeCanvas].getActiveObject();\n        var toolObj;\n\n        if (inst.activeTool == 2) { // Text Box\n            toolObj = new fabric.IText(inst.textBoxText, {\n                left: event.clientX - fabricObj.upperCanvasEl.getBoundingClientRect().left,\n                top: event.clientY - fabricObj.upperCanvasEl.getBoundingClientRect().top,\n                fill: inst.color,\n                fontSize: inst.font_size,\n                lockRotation: true,\n                lockScalingX: true,\n                lockScalingY: true\n            });\n        } else if (inst.activeTool == 4) { // Highlight Box\n            toolObj = new fabric.Rect({\n                left: event.clientX - fabricObj.upperCanvasEl.getBoundingClientRect().left,\n                top: event.clientY - fabricObj.upperCanvasEl.getBoundingClientRect().top,\n                width: inst.highlightBoxWidth,\n                height:  inst.highlightBoxHeight,\n                fill: inst.color,\n                opacity: inst.highlightBoxOpacity,\n                lockRotation: true\n            });\n        } else if (inst.activeTool == 0) { // Select\n            if (activeObject) {\n                // Locking the rotation and scaling of free hand brush, if it is currently selected\n                if (activeObject.get('type') == 'path') {\n                    activeObject.set({\n                        lockScalingX: true,\n                        lockScalingY: true,\n                        lockRotation: true});\n                }\n            }\n        }\n\n        // Change the current selected tool in the UI to Select if the active tool is highlight box or text\n        if (inst.activeTool == 2 || inst.activeTool == 4) {\n            var element = document.querySelector(\"#select\");\n            $(\".tool-button.active\").removeClass(\"active\");\n            $(element).addClass(\"active\");\n        }\n\n        // Change the currently active tool to Select\n        inst.activeTool = 0;\n        if (toolObj) {\n                fabricObj.add(toolObj);\n        }\n    };\n};\n\nPDFAnnotate.prototype.enableSelector = function() {\n    var inst = this;\n    inst.activeTool = 0;\n    if (inst.fabricObjects.length > 0) {\n        $.each(inst.fabricObjects, function(index, fabricObj) {\n            fabricObj.isDrawingMode = false;\n        });\n    }\n\n\n};\n\nPDFAnnotate.prototype.enablePencil = function() {\n    var inst = this;\n    inst.activeTool = 1;\n    if (inst.fabricObjects.length > 0) {\n        $.each(inst.fabricObjects, function(index, fabricObj) {\n            fabricObj.freeDrawingBrush.width = inst.freeDrawingBrushWidth; // Changed default brush size\n            fabricObj.isDrawingMode = true;\n        });\n    }\n\n};\n\nPDFAnnotate.prototype.enableAddText = function() {\n    var inst = this;\n    inst.activeTool = 2;\n    if (inst.fabricObjects.length > 0) {\n        $.each(inst.fabricObjects, function(index, fabricObj) {\n            fabricObj.isDrawingMode = false;\n        });\n    }\n\n};\n\nPDFAnnotate.prototype.enableRectangle = function() {\n    var inst = this;\n    inst.activeTool = 4;\n    if (inst.fabricObjects.length > 0) {\n        $.each(inst.fabricObjects, function(index, fabricObj) {\n            fabricObj.isDrawingMode = false;\n        });\n    }\n};\n\nPDFAnnotate.prototype.deleteSelectedObject = function() {\n    var inst = this;\n    var activeObject = inst.fabricObjects[inst.activeCanvas].getActiveObject();\n    if (activeObject) {\n        if (confirm('Are you sure ?')) { // eslint-disable-line no-alert\n            inst.fabricObjects[inst.activeCanvas].remove(activeObject);\n        }\n    }\n};\n\n// Updated by Asha Jose and Parvathy S Kumar\n  PDFAnnotate.prototype.savePdf = function() {\n    // Calling the serializePdf function\n    this.serializePdf(function(string) {\n      var value = JSON.stringify(JSON.parse(string), null, 4);\n\n      var xmlhttp = new XMLHttpRequest(); // Creating an HTTP request instance\n      xmlhttp.open(\"POST\", \"upload.php\", true);\n      xmlhttp.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n      // Sending data to upload.php\n      xmlhttp.send(\"data=\" + value + \"&contextid=\" + contextid + \"&attemptid=\" + attemptid // Changed id to data\n      + \"&filename=\" + filename + \"&usageid=\" + usageid + \"&slot=\" + slot);\n      xmlhttp.onreadystatechange = function() {\n\n        // Getting the response once upload.php finishes execution\n        // The variable readyState will become 4 if the execution finishes\n        if (this.status == 200 && this.readyState == 4) {\n            showMessage(1);\n        } else if (this.status != 200 && this.readyState == 4) {\n            showMessage(0);\n        }\n\n        /**\n         * Displays a message box with the given message.\n         *\n         * @param {int} message - 1 if the file has been saved, 0 otherwise.\n         */\n        function showMessage(message) {\n            // Getting the message box\n            var messageBox = document.getElementById(\"message-box-saved\");\n            if (message == 0) {\n                messageBox = document.getElementById(\"message-box-not-saved\");\n            }\n\n            // Showing the message box\n            messageBox.classList.remove(\"hidden\");\n\n            // Automatically remove the message box after 3 seconds\n            setTimeout(function() {\n                messageBox.style.opacity = \"0\";\n                setTimeout(function() {\n                    document.getElementById(\"essayannotator-annotator\").removeChild(messageBox);\n                    window.close();\n                    window.opener.location.reload();\n                }, 500); // Fade-out transition time\n            }, 3000); // Display time\n        }\n      };\n    });\n};\n\n\n// Convert the Page Annotations to JSON data\nPDFAnnotate.prototype.serializePdf = function(callback) {\n    var inst = this;\n    var pageAnnotations = [];\n    // Initialising list of fabric objects for each page\n    // Length of fabricObjects is the number of pages\n    for (let i = 0; i < inst.fabricObjects.length; i++) {\n      pageAnnotations.push([]);\n    }\n\n    // The function is invoked for each page  to iterate through the annotations\n    inst.fabricObjects.forEach(function(fabricObject, index) {\n      fabricObject.clone(function(fabricObjectCopy) {\n        fabricObjectCopy.setBackgroundImage(null);\n        fabricObjectCopy.setBackgroundColor('');\n        if (fabricObjectCopy._objects.length !== 0) { // Checking if the page has any annotations\n            for (var j = 0; j < fabricObjectCopy._objects.length; j++) { // Iterate through the list of annotations\n                // Used to handle the translation of path object(free hand)\n                if (fabricObjectCopy._objects[j].get('type') == 'path') {\n                    var pathObj = fabricObjectCopy._objects[j];\n                    var matrix = pathObj.calcTransformMatrix();\n                    var pointsList = pathObj.path;\n                    var length = Object.keys(pointsList).length;\n                    var offsetX = pathObj.pathOffset.x;\n                    var offsetY = pathObj.pathOffset.y;\n                    for (var i = 0; i < length; i++) {\n                        var point1 = new fabric.Point(pointsList[i][1], pointsList[i][2]);\n                        var newPoints1 = fabric.util.transformPoint(point1, matrix);\n                        pointsList[i][1] = newPoints1.x - offsetX;\n                        pointsList[i][2] = newPoints1.y - offsetY;\n\n                        if (i != 0 && i != length - 1) {\n                            // First and Last elements in the pointsList have only a single set of coordinate\n                            // All the other elements have 2 set of points\n                            var point2 = new fabric.Point(pointsList[i][3], pointsList[i][4]);\n                            var newPoints2 = fabric.util.transformPoint(point2, matrix);\n                            pointsList[i][3] = newPoints2.x - offsetX;\n                            pointsList[i][4] = newPoints2.y - offsetY;\n                        }\n                    }\n                    // Copy transformed list of points to the path object\n                    fabricObjectCopy._objects[j].path = pointsList;\n                }\n              }\n\n            pageAnnotations[index].push(fabricObjectCopy);\n        }\n\n        if (index + 1 === inst.fabricObjects.length) {\n          var data = {\n            page_setup: {\n              format: inst.format,\n              orientation: inst.orientation,\n            },\n            pages: pageAnnotations,\n          };\n          callback(JSON.stringify(data)); // The serialized data is converted to JSON\n        }\n      });\n    });\n  };\n// Updation ends\n\nPDFAnnotate.prototype.setColor = function(color) {\n    var inst = this;\n    inst.color = color;\n    $.each(inst.fabricObjects, function(index, fabricObj) {\n        fabricObj.freeDrawingBrush.color = color;\n    });\n};\n\nPDFAnnotate.prototype.setBorderColor = function(color) {\n    var inst = this;\n    inst.borderColor = color;\n};\n\nPDFAnnotate.prototype.setFontSize = function(size) {\n    this.font_size = size;\n};\n\nreturn {\n    PDFAnnotate: PDFAnnotate, // Exporting PDFAnnotate constructor\n    init: function(contextId, attemptId, fileName, usageId, sloT) {\n        contextid = contextId;\n        attemptid = attemptId;\n        filename = fileName;\n        usageid = usageId;\n        slot = sloT;\n    }\n};\n});"],"names":["define","fabric","pdfjsLib","$","contextid","attemptid","filename","usageid","slot","PDFAnnotate","containerId","url","options","arguments","length","undefined","this","numberOfPages","pagesRendered","activeTool","fabricObjects","fabricObjectsData","color","borderColor","borderSize","font_size","activeCanvas","pageImageCompression","toUpperCase","textBoxText","highlightBoxWidth","highlightBoxHeight","highlightBoxOpacity","freeDrawingBrushWidth","inst","GlobalWorkerOptions","workerSrc","getDocument","promise","then","pdf","scale","numPages","i","getPage","page","format","orientation","originalViewport","getViewport","width","height","viewport","canvas","document","createElement","getElementById","appendChild","className","renderContext","canvasContext","getContext","render","each","index","el","attr","initFabric","reason","canvases","background","toDataURL","fabricObj","Canvas","id","push","setBackgroundImage","renderAll","bind","upperCanvasEl","click","event","fabricClickHandler","on","toJSON","off","ready","toolObj","activeObject","getActiveObject","IText","left","clientX","getBoundingClientRect","top","clientY","fill","fontSize","lockRotation","lockScalingX","lockScalingY","Rect","opacity","get","set","element","querySelector","removeClass","addClass","add","prototype","enableSelector","isDrawingMode","enablePencil","freeDrawingBrush","enableAddText","enableRectangle","deleteSelectedObject","confirm","remove","savePdf","serializePdf","string","value","JSON","stringify","parse","xmlhttp","XMLHttpRequest","open","setRequestHeader","send","onreadystatechange","showMessage","message","messageBox","classList","setTimeout","style","removeChild","window","close","opener","location","reload","status","readyState","callback","pageAnnotations","forEach","fabricObject","clone","fabricObjectCopy","setBackgroundColor","_objects","j","pathObj","matrix","calcTransformMatrix","pointsList","path","Object","keys","offsetX","pathOffset","x","offsetY","y","point1","Point","newPoints1","util","transformPoint","point2","newPoints2","data","page_setup","pages","setColor","setBorderColor","setFontSize","size","init","contextId","attemptId","fileName","usageId","sloT"],"mappings":"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"}